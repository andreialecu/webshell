(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{142:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return u}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),b=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=b(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=b(n),m=a,u=p["".concat(o,".").concat(m)]||p[m]||d[m]||r;return n?i.a.createElement(u,c(c({ref:t},s),{},{components:n})):i.a.createElement(u,c({ref:t},s))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<r;s++)o[s]=n[s];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},143:function(e,t,n){"use strict";var a=n(0),i=n(20);t.a=function(){const e=Object(a.useContext)(i.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},144:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o}));var a=n(143),i=n(146);function r(){const{siteConfig:{baseUrl:e="/",url:t}={}}=Object(a.a)();return{withBaseUrl:(n,a)=>function(e,t,n,{forcePrependBaseUrl:a=!1,absolute:r=!1}={}){if(!n)return n;if(n.startsWith("#"))return n;if(Object(i.b)(n))return n;if(a)return t+n;const o=n.startsWith(t)?n:t+n.replace(/^\//,"");return r?e+o:o}(t,e,n,a)}}function o(e,t={}){const{withBaseUrl:n}=r();return n(e,t)}},145:function(e,t,n){"use strict";function a(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}t.a=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(i&&(i+=" "),i+=t);return i}},146:function(e,t,n){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!a(e)}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}))},147:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o}));var a=n(0),i=n(144);const r=({reference:e,member:t,type:n})=>a.createElement("span",{className:"api-symbol "+n},e,t?"."+t:""),o=({reference:e,type:t,overrideUrl:n,member:r})=>{const o=r?"#"+r.toLowerCase():"",c="interface"===t?`/docs/api/interfaces/${e.toLowerCase()}${o}`:"class"===t?`/docs/api/classes/${e.toLowerCase()}${o}`:"enum"===t?`/docs/api/enums/${e.toLowerCase()}${o}`:"type"===t||"alias"===t?`/docs/api/types/${e.toLowerCase()}${o}`:"function"===t?`/docs/api/functions/${e.toLowerCase()}${o}`:"variable"===t?`/docs/api/variables/${e.toLowerCase()}${o}`:null;if(null===c)throw new TypeError(`APIReference: ${t} must be one of 'interface', 'class', 'type', 'alias', 'function' or 'variable'.`);return a.createElement("a",{className:"api-ref api-symbol "+t,href:Object(i.a)(n||c)},e,r?"."+r:"")}},149:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c}));var a=n(0),i=n.n(a);const r={webview:"https://github.com/react-native-community/react-native-webview",scrollview:"https://reactnative.dev/docs/scrollview",linking:"https://reactnative.dev/docs/linking",__dev__:"https://reactnative.dev/docs/javascript-environment.html"},o=({name:e,type:t})=>{const n=r[e&&e.toLowerCase()],a=n?e:"MISSING REFERENCE FOR "+e;return i.a.createElement("a",{className:"api-ref api-symbol "+t,href:n},a)},c=()=>i.a.createElement(o,{name:"WebView",type:"class"})},150:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return h})),n.d(t,"b",(function(){return j}));var a=n(162),i=n.n(a),r=n(163),o=n(0),c=n(156),l=n(144),s=n(160),b=n(161);function p(e){var t=o.useState({content:"",error:!1}),n=t[0],a=t[1];return o.useEffect((function(){var t=!1;function n(){return(n=Object(r.a)(i.a.mark((function n(){var r,o;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch(e);case 3:if(!(r=n.sent).ok){n.next=11;break}return n.next=7,r.text();case 7:o=n.sent,!t&&a({error:!1,content:o}),n.next=12;break;case 11:!t&&a({error:!0,content:""});case 12:n.next=18;break;case 14:n.prev=14,n.t0=n.catch(0),console.info(n.t0),!t&&a({error:!0,content:""});case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))).apply(this,arguments)}return function(){n.apply(this,arguments)}(),function(){t=!0}}),[e]),n}var d=function(e){var t=e.children;return o.createElement("div",{className:"margin-vert--md mdxCodeBlock__-node_modules-@docusaurus-theme-classic-lib-theme-MDXComponents-"},t)},m=function(e){var t=e.lang,n=e.lines,a=e.title,i=e.content;return o.createElement(c.a,{className:"language-"+t,metastring:(n?"{"+n+"}":"")+" "+(a?'title="'+a+'"':""),title:a},i)},u=function(e){var t=e.source,n=e.lang,a=e.lines,i=e.title,r=Object(l.a)("/snippets/"+t),c=p(r),s=i||t;return c.error?o.createElement("div",{className:"admonition admonition-warning alert alert--danger"},r," snippet could not be loaded"):o.createElement(d,null,o.createElement(m,{lang:n,content:c.content,lines:a,title:s}))},h=function(e){var t=e.packages,n=e.dev,a=void 0!==n&&n;return o.createElement(s.a,{defaultValue:"yarn",groupId:"package-manager",values:[{label:"yarn",value:"yarn"},{label:"npm",value:"npm"}]},o.createElement(b.a,{value:"yarn"},o.createElement(m,{lang:"sh",content:"yarn add "+(a?"--dev ":"")+t.split(/\s+/).join(" \\\n         ")})),o.createElement(b.a,{value:"npm"},o.createElement(m,{lang:"sh",content:"npm install --save "+(a?"--only=dev ":"")+t.split(/\s+/).join(" \\\n    ")})))},j=function(e){var t=e.sourceBase,n=e.titleBase,a=e.jsx,i=void 0!==a&&a,r=e.lines,c=void 0===r?null:r,u=Object(l.a)("/snippets/"+t+"."+(i?"tsx":"ts")),h=Object(l.a)("/snippets/"+t+"."+(i?"jsx":"js")),j=p(u),O=p(h),f=n||t;return j.error?o.createElement("div",{className:"admonition admonition-warning alert alert--danger"},u," snippet could not be loaded"):O.error?o.createElement("div",{className:"admonition admonition-warning alert alert--danger"},h," snippet could not be loaded"):o.createElement(d,null,o.createElement(s.a,{defaultValue:"ts",groupId:"javascript-source",values:[{label:"Typescript",value:"ts"},{label:"JavaScript",value:"js"}]},o.createElement(b.a,{value:"ts"},o.createElement(m,{lang:i?"tsx":"ts",content:j.content,lines:c,title:f+"."+(i?"tsx":"ts")})),o.createElement(b.a,{value:"js"},o.createElement(m,{lang:i?"jsx":"js",content:O.content,lines:c,title:f+"."+(i?"jsx":"js")}))))}},151:function(e,t,n){"use strict";var a=n(0);const i=n.n(a).a.createContext(void 0);t.a=i},152:function(e,t,n){"use strict";var a=n(0);const i=Object(a.createContext)(void 0);t.a=i},153:function(e,t,n){"use strict";var a=n(0),i=n(151);t.a=function(){const e=Object(a.useContext)(i.a);if(null==e)throw new Error("`useThemeContext` is used outside of `Layout` Component. See https://v2.docusaurus.io/docs/theme-classic#usethemecontext.");return e}},154:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(0);const i=()=>a.createElement("span",{className:"webshell"},"webshell")},155:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(0);const i={hoc:"Higher Order Component",dom:"Document Object Model"},r={hoc:"https://reactjs.org/docs/higher-order-components.html",viewport:"https://developer.mozilla.org/en-US/docs/Glossary/Viewport",hooks:"https://reactjs.org/docs/hooks-overview.html",dom:"https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction","messaging system":"https://github.com/react-native-community/react-native-webview/blob/master/docs/Guide.md#communicating-between-js-and-native"},o=({id:e,title:t})=>{const n=r[e&&e.toLowerCase()],o=i[e&&e.toLowerCase()],c=void 0===n?`MISSING REFERENCE '${e}'`:t||e,l=e=>o?a.createElement("abbr",e):a.createElement("span",e);return a.createElement("strong",null,a.createElement(l,{title:o||void 0},a.createElement("a",{className:"term",title:o||null,href:n},c)))}},157:function(e,t,n){"use strict";var a=n(0),i=n(152);t.a=function(){const e=Object(a.useContext)(i.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},159:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(0),i=n(147);const r=e=>a.createElement("div",{className:"card api-box shadow--lt",style:{textAlign:"center"}},a.createElement("div",{className:"card__header api-box__title"},"~ API Reference ~"),a.createElement(i.a,e))},99:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return b})),n.d(t,"metadata",(function(){return p})),n.d(t,"rightToc",(function(){return d})),n.d(t,"default",(function(){return u}));var a=n(2),i=n(6),r=(n(0),n(142)),o=(n(154),n(155),n(147)),c=n(149),l=n(159),s=n(150),b={id:"implementing-features",title:"Implementing Web Features"},p={unversionedId:"implementing-features",id:"implementing-features",isDocsHomePage:!1,title:"Implementing Web Features",description:"import {",source:"@site/docs/implementing-features.mdx",slug:"/implementing-features",permalink:"/webshell/docs/implementing-features",editUrl:"https://github.com/formidable-webview/webshell/tree/master/apps/website/docs/docs/implementing-features.mdx",version:"current",lastUpdatedBy:"Jules Sam. Randolph",lastUpdatedAt:1602268396,sidebar:"someSidebar",previous:{title:"Autoheight WebView",permalink:"/webshell/docs/autoheight"},next:{title:"Tooling",permalink:"/webshell/docs/tooling"}},d=[{value:"Web to Native Communication",id:"web-to-native-communication",children:[{value:"Web Script",id:"web-script",children:[]},{value:"Building a Feature Class",id:"building-a-feature-class",children:[]},{value:"Using the Feature",id:"using-the-feature",children:[]}]},{value:"Native to Web Communication",id:"native-to-web-communication",children:[{value:"Declaring Web Handler",id:"declaring-web-handler",children:[]},{value:"Registering the Web Handler",id:"registering-the-web-handler",children:[]},{value:"Using the Feature",id:"using-the-feature-1",children:[]}]},{value:"Testing with Jest",id:"testing-with-jest",children:[{value:"Install Ersatz and Testing Library",id:"install-ersatz-and-testing-library",children:[]},{value:"Implementing Tests",id:"implementing-tests",children:[]}]},{value:"Web-Engines Compatibility",id:"web-engines-compatibility",children:[]}],m={rightToc:d};function u(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},m,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Features can set up communication in both directions, ",Object(r.b)("em",{parentName:"p"},"Web to native")," and ",Object(r.b)("em",{parentName:"p"},"native to Web"),".\nWe will approach the two in distinct examples, but a feature can support both at the same time."),Object(r.b)("h2",{id:"web-to-native-communication"},"Web to Native Communication"),Object(r.b)("p",null,"To overview Web to native communication, we will take a look at\na simplified implementation of ",Object(r.b)(o.a,{reference:"HandleLinkPressFeature",type:"variable",mdxType:"APIReference"}),"."),Object(r.b)("p",null,"A feature has two facets:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"#web-script"}),"Web Script"),", which embodies behavior in the Web environment;"),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"#building-a-feature-class"}),"Feature Class"),", which tackles integration with the shell.")),Object(r.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"disclaimer")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"This implementation is naive and doesn't handle inner click events. If you need such a feature, use our official ",Object(r.b)(o.a,{reference:"HandleLinkPressFeature",type:"variable",mdxType:"APIReference"}),"."))),Object(r.b)("h3",{id:"web-script"},"Web Script"),Object(r.b)("p",null,"Let's start with the Web script, the code which will run in the ",Object(r.b)(c.a,{name:"WebView",type:"class",mdxType:"ReactReference"}),"."),Object(r.b)(s.d,{source:"HandleLinkPressFeature.webjs",lang:"js",mdxType:"SingleCodeSource"}),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Every Web script top declaration must be a function")," taking one argument.\nThe shape of this argument is depicted in ",Object(r.b)(o.b,{reference:"WebjsContext",type:"interface",mdxType:"APISymbolFormat"})," definition.\nThis context object is the central API to interact with the shell from the Web environment."),Object(r.b)(l.a,{reference:"WebjsContext",type:"interface",mdxType:"APIBox"}),Object(r.b)("p",null,"Below is the same snippet with highlighted lines each matching a different context usage:"),Object(r.b)(s.d,{lines:"5,6,11,16",source:"HandleLinkPressFeature.webjs",lang:"js",mdxType:"SingleCodeSource"}),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("inlineCode",{parentName:"li"},"context.options")," is the result of shallow-merging ",Object(r.b)("inlineCode",{parentName:"li"},"defaultOptions")," with user-provided options during feature instantiation."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("inlineCode",{parentName:"li"},"context.postMessageToShell")," will send an event which will be intercepted by the shell. If an event handler has been registered for this feature and passed as a prop to the shell, it will be invoked with the message content."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("inlineCode",{parentName:"li"},"context.warn")," and ",Object(r.b)("inlineCode",{parentName:"li"},"context.info")," will send a log event to the shell when ",Object(r.b)("inlineCode",{parentName:"li"},"webshellDebug")," prop is set to ",Object(r.b)("inlineCode",{parentName:"li"},"true"),". The shell will log the message in the native environment for quick feedback during development."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("inlineCode",{parentName:"li"},"context.makeCallbackSafe")," guarantees that any error raised in the body of the callback will be intercepted by the context API and routed to the shell for quick feedback during development.")),Object(r.b)("h3",{id:"building-a-feature-class"},"Building a Feature Class"),Object(r.b)(l.a,{reference:"FeatureBuilder",type:"class",mdxType:"APIBox"}),Object(r.b)("p",null,"Now let's dive into the native-side. As you can see, the definition is relatively terse:"),Object(r.b)(s.b,{sourceBase:"HandleLinkPressFeature",mdxType:"DualCodeSource"}),Object(r.b)("p",null,"Below is a recap of all the symbols present in this snippet:"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:"left"}),"Symbol"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:"left"}),"Description"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(r.b)("inlineCode",{parentName:"td"},"linkPressScript")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"Behavior in the Web environment (",Object(r.b)("inlineCode",{parentName:"td"},"string"),").")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(r.b)("inlineCode",{parentName:"td"},"defaultOptions")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"Default options for this feature (",Object(r.b)("inlineCode",{parentName:"td"},"object"),").")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(r.b)("inlineCode",{parentName:"td"},'"onDOMLinkPress"')),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"The name of the handler prop which will be available in the shell (",Object(r.b)("inlineCode",{parentName:"td"},"string"),").")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(r.b)("inlineCode",{parentName:"td"},'"org.myorg/webshell.link-press"')),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"A unique identifier for this feature (",Object(r.b)("inlineCode",{parentName:"td"},"string"),").")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(r.b)("inlineCode",{parentName:"td"},"LinkPressOptions")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"[",Object(r.b)("strong",{parentName:"td"},"Typescript"),"]"," The shape of options the feature class can be instantiated with.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),Object(r.b)("inlineCode",{parentName:"td"},"LinkPressTarget")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:"left"}),"[",Object(r.b)("strong",{parentName:"td"},"Typescript"),"]"," The type of payload the handler prop will receive.")))),Object(r.b)("p",null,"It is also worth noting that invoking ",Object(r.b)("inlineCode",{parentName:"p"},"withShellHandler")," is not an option:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"It register the handler to the shell, otherwise events fired by the below Web script will not be routed to the corresponding handler prop (",Object(r.b)("inlineCode",{parentName:"li"},"onDOMLinkPress"),")."),Object(r.b)("li",{parentName:"ol"},"When implemented in typescript, type generation will add the shell handler name and payload type to the the feature, which will be grabbed by the resulting shell prop type.")),Object(r.b)("div",{className:"admonition admonition-important alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Be advised that ",Object(r.b)("inlineCode",{parentName:"p"},"linkPressScript")," must be a ",Object(r.b)("inlineCode",{parentName:"p"},"string"),". In the snippet, we are using ",Object(r.b)("inlineCode",{parentName:"p"},"babel-plugin-inline-import")," to import the Web script as ",Object(r.b)("inlineCode",{parentName:"p"},"string"),", see the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"./tooling"}),"tooling guide"),";"))),Object(r.b)("div",{className:"admonition admonition-important alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Don't forget to invoke ",Object(r.b)("inlineCode",{parentName:"p"},"build")," method, otherwise you'll end up with a ",Object(r.b)(o.a,{reference:"FeatureBuilder",type:"class",mdxType:"APIReference"})," instance."))),Object(r.b)("h3",{id:"using-the-feature"},"Using the Feature"),Object(r.b)(s.b,{jsx:!0,sourceBase:"WebViewWithOnLinkPress",mdxType:"DualCodeSource"}),Object(r.b)("h2",{id:"native-to-web-communication"},"Native to Web Communication"),Object(r.b)("p",null,"Until now, we have previewed how to send messages from the Web environment to the shell.\nLet's say we now want to pass an ",Object(r.b)("inlineCode",{parentName:"p"},"apiToken")," prop to our Web script so that it\nexecute some authentication logic when the controlling component prop changes."),Object(r.b)("p",null,"To allow communication from the shell to the Web environment, we will need to do the following:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Declare a Web handler with the ",Object(r.b)("inlineCode",{parentName:"li"},"FeatureBuilder"),";"),Object(r.b)("li",{parentName:"ul"},"Register a handler in the Web script;"),Object(r.b)("li",{parentName:"ul"},"Use a ",Object(r.b)(o.a,{reference:"WebHandle",type:"alias",mdxType:"APIReference"})," from the shell to send ",Object(r.b)("inlineCode",{parentName:"li"},"apiTokens"),".")),Object(r.b)("h3",{id:"declaring-web-handler"},"Declaring Web Handler"),Object(r.b)("p",null,"We need to register a handler associated with the feature to allow the\nshell to convey messages to the appropriate destination.\nLet's use ",Object(r.b)(o.a,{reference:"FeatureBuilder",type:"class",member:"withWebHandler",mdxType:"APIReference"})," to declare a Web handler.\nThe handler will need an identifier, ",Object(r.b)("inlineCode",{parentName:"p"},"'apiTokenChange'"),", to disambiguate from multiple messages."),Object(r.b)(s.b,{sourceBase:"FeatureWithToken",mdxType:"DualCodeSource"}),Object(r.b)("h3",{id:"registering-the-web-handler"},"Registering the Web Handler"),Object(r.b)("p",null,"Now we need to do something with the token.\nWe will use ",Object(r.b)(o.a,{reference:"WebjsContext",type:"interface",member:"onShellMessage",mdxType:"APIReference"})," to register a listener function."),Object(r.b)("div",{className:"admonition admonition-important alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The first argument, ",Object(r.b)("inlineCode",{parentName:"p"},"'apiTokenChange'"),", must match the first argument of ",Object(r.b)("inlineCode",{parentName:"p"},"withWebHandler"),"."))),Object(r.b)(s.d,{source:"FeatureWithToken.webjs",lang:"js",mdxType:"SingleCodeSource"}),Object(r.b)("h3",{id:"using-the-feature-1"},"Using the Feature"),Object(r.b)("p",null,"Finally, we need to pass the token from the shell to the Web script.\nWe will use ",Object(r.b)(o.a,{reference:"WebshellInvariantProps",type:"interface",member:"webHandleRef",mdxType:"APIReference"})," to imperatively send messages:"),Object(r.b)(s.b,{jsx:!0,sourceBase:"APIComponent",mdxType:"DualCodeSource"}),Object(r.b)("p",null,"That's it. Our Web script is almost a React component now, it can ",Object(r.b)("em",{parentName:"p"},"react")," to prop changes!"),Object(r.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"If your script relies on multiple props, it is best advised for performance and synchronization concerns to use one ",Object(r.b)("inlineCode",{parentName:"p"},"useEffect")," with a payload comprising all props."))),Object(r.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Make sure to follow the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://reactjs.org/docs/hooks-rules.html"}),"rules of hooks")," and declare dependencies accordingly in ",Object(r.b)("inlineCode",{parentName:"p"},"useEffect"),":"),Object(r.b)("ul",{parentName:"div"},Object(r.b)("li",{parentName:"ul"},"Declaring no dependencies will cause the effect callback to execute on every render cycle, which might jam the native to Web communication bus;"),Object(r.b)("li",{parentName:"ul"},"Missing dependencies could cause ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://dmitripavlutin.com/react-hooks-stale-closures/"}),"stale closures")," and inconsistencies.")))),Object(r.b)("h2",{id:"testing-with-jest"},"Testing with Jest"),Object(r.b)("p",null,"Let's go back to our ",Object(r.b)("inlineCode",{parentName:"p"},"HandleLinkPressFeature")," and implement a simple test."),Object(r.b)("h3",{id:"install-ersatz-and-testing-library"},"Install Ersatz and Testing Library"),Object(r.b)("p",null,"To test injected scripts, the best way is to use\n",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/formidable-webview/ersatz"}),Object(r.b)("inlineCode",{parentName:"a"},"@formidable-webview/ersatz")),".\nIt will mock the WebView and run a Web environment in ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/jsdom/jsdom"}),"jsdom"),"."),Object(r.b)(s.c,{dev:!0,packages:"@testing-library/react-native @formidable-webview/ersatz @formidable-webview/ersatz-testing",mdxType:"InstallPackageSnippet"}),Object(r.b)("h3",{id:"implementing-tests"},"Implementing Tests"),Object(r.b)(s.b,{jsx:!0,sourceBase:"HandleLinkPressFeature.test",mdxType:"DualCodeSource"}),Object(r.b)("h2",{id:"web-engines-compatibility"},"Web-Engines Compatibility"),Object(r.b)("p",null,"For wide compatibility purposes ",Object(r.b)("strong",{parentName:"p"},"of the Web script"),", it is recommended to:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"enforce ECMAScript 5 syntax with ESlint;"),Object(r.b)("li",{parentName:"ul"},"lint the script with the\n",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.npmjs.com/package/eslint-plugin-compat"}),"eslint-plugin-compat")," to\nenforce backward compatibility with old engines;")),Object(r.b)("p",null,"See the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"./tooling"}),"tooling guide")," for more details on how to achieve this."))}u.isMDXComponent=!0}}]);