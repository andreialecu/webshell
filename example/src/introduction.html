<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <style>
      body {
        background-color: #2b2b2b;
        color: #c9c9c9;
        box-sizing: border-box;
        font-size: 14px;
        margin: 0;
      }
      h2,
      h3 {
        color: white;
        font-family: serif;
      }
      h2 {
        font-size: 1.8em;
        text-align: center;
      }
      * {
        box-sizing: border-box;
      }
      li {
        margin-bottom: 10px;
      }
      #root {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
      }
      header, footer {
        color: aliceblue;
        font-style: italic;
        background-color: #1b1b1b;
        padding: 20px;
        line-height: 1.2;
      }
      header {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        align-items: center;
      }
      footer {
        width: 100%;
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: center;
        min-height: 80px;
        text-align: center;
        transition: height 60ms ease;
      }
      article {
        padding: 10px;
        max-width: 480px;
      }
      strong {
        color: white;
        font-weight: normal;
      }
      button {
        background-color: transparent;
        display: inline-block;
        padding: 0.35em 1.2em;
        border: 0.1em solid white;
        margin: 0 0.3em 0.3em 0;
        border-radius: 0.12em;
        box-sizing: border-box;
        text-decoration: none;
        font-weight: 300;
        color: white;
        text-align: center;
        transition: all 200ms;
        font-size: 18px;
        margin: 6px;
        font-family: monospace;
      }
      button:active {
        color: #1a1a1a;
        background-color: white;
      }
      button:focus {
        outline-color: white;
        outline-width: 4px;
      }
      code {
        color: white;
        font-size: 13px;
      }
      a {
        color: #8396e9;
      }
      a[href^='#'] {
        color: white;
        font-style: normal;
        border: 1px solid #a4aeda;
        padding: 1px;
        text-decoration: none;
      }
      .workaround {
        position: relative;
        padding: 10px;
        border: 1px solid #d4aa00;
        border-radius: 10px;
        background-color: #303030;
      }
      .workaround::before {
        content: 'ðŸ’¡';
        line-height: 1em;
        left: -20px;
        top: calc(50% - 0.5em);
        position: absolute;
        font-weight: bold;
      }
      .subtitle a {
        color: #a4aeda;
      }
      .subtitle img {
        margin-right: 8px;
      }
      .container {
        padding: 10px;
        display: flex;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <header>
        <a href="https://github.com/formidable-webview/webshell#readme">
          <img
            src="https://avatars3.githubusercontent.com/u/69217828?s=400&u=f3c683287f866a197e49df2c7308fed60df79589&v=4"
            width="40"
            height="40"
          />
        </a>
        <span>
          This solution is based on <code>makeWebshell</code>
          <a href="https://reactjs.org/docs/higher-order-components.html"
            >HOC</a
          >
          and <code>useAutoheight</code>
          hook exported by
          <a href="https://github.com/formidable-webview/webshell#readme"
            >@formidable-webview/webshell</a
          >.
        </span>
      </header>
      <article>
        <div class="title">
          <h2>
            Craft a Full-Featured, Dynamic Autoheight WebView-based component
            with <em>webshell</em>
          </h2>
        </div>
        <h3>Pros</h3>
        <ul>
          <li>
            The <strong>width</strong> of the viewport will grow to the
            available horizontal space and won't need to be specified. You can
            override this behavior by setting explicit <code>width</code> as a
            named argument of <code>useAutoheight</code> hook.
          </li>
          <li>
            The <strong>height</strong> of the viewport, also called layout
            height, will dynamically adapts to the content height, which has
            been constrained by the layout width as we have just mentioned! It
            means that anytime the content changes or the layout width changes,
            such as in screen rotations, the layout height will get updated. See
            the <a href="#play">&darr;&nbsp;Play</a> section below.
          </li>
          <li>
            This hook will rely on webshell's
            <code>handleHTMLDimensionsFeature</code> to use the best API
            available in the browser
            <strong> and dynamically adapt layout to content size</strong>. In
            order of preference,
            <a
              href="https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver"
              >ResizeObserver</a
            >,
            <a
              href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver"
              >MutationObserver</a
            >
            and finally, simple polling.
          </li>
          <li>
            When the content overflows the layout on the horizontal axis, you
            can still scroll horizontally. The scroll is happening inside the
            <code>WebView</code>.
          </li>
        </ul>
        <h3>Caveats and Workarounds</h3>
        <ul>
          <li>
            Because the <strong>viewport height</strong> is now
            <strong>bound</strong> to the <strong>content heigh</strong>, you
            must not have a <strong>body</strong> element height depending on
            viewport height, such as when using <code>height: 100vh;</code> or
            <code>height: 100%;</code>. That is an evil cyclic dependency ready
            to cast an infinite loop!
            <p class="workaround">
              This can be enforced by setting body height to
              <strong>auto</strong> with webshell's
              <code>forceElementSizeFeature</code>.
            </p>
          </li>
          <li>
            In some circumstances, the mobile browser might use a virtual
            viewport much larger then the available width in the WebView, often
            around 980px for websites which have been built for desktop. For
            this autoheight component to be reliable, you must ensure that the
            content has a
            <a href="https://www.w3schools.com/css/css_rwd_viewport.asp"
              >meta viewport element</a
            >
            in the header.
            <p class="workaround">
              This can be enforced by setting responsive layout with webshell's
              <code>forceResponsiveViewportFeature</code>.
            </p>
          </li>
          <li>
            Scroll to hash on link press (#) will not work out of the box,
            because the <code>WebView</code> is not scrollable anymore.
            <p class="workaround">
              However, you can react to
              <a
                href="https://developer.mozilla.org/en-US/docs/Web/API/Window/hashchange_event"
                >hash changes</a
              >
              and scroll imperatively with <code>handleHashChangeFeature</code>.
              This is exactly how it is implemented here,
              <a href="#root">&uarr;&nbsp;try&nbsp;this</a>.
            </p>
          </li>
        </ul>
        <h3 id="play">Play</h3>
        <ul>
          <li>
            <strong>Shrink</strong> and <strong>increase footer</strong> by
            pressing buttons above footer and notice how the <code>WebView</code> height
            adapts dynamically.
          </li>
        </ul>
        <ul>
          <li>
            <strong>Rotate</strong> the <strong>screen</strong> and observe how
            the <code>WebView</code> height and width will adjust.
          </li>
          <li>
            Change configuration by pressing the app bar button below and
            observe how this <code>WebView</code> react.
          </li>
        </ul>
      </article>
      <div style="margin-bottom: 20px;" class="container">
        <button onclick="shrinkDiv()">-20</button>
        <button onclick="increaseDiv()">+20</button>
      </div>
      <footer id="footer">
        <em>Change this footer height with the controls above.</em>
        <div class="container">
          <a href="#root">&uarr;&nbsp;back&nbsp;to&nbsp;top</a>
        </div>
      </footer>

      <script>
        function shrinkDiv() {
          var div = document.getElementById('footer');
          var currentHeight = Number(
            getComputedStyle(div).height.match(/[\d.]+/)[0]
          );
          div.style.height = currentHeight - 20 + 'px';
        }
        function increaseDiv() {
          var div = document.getElementById('footer');
          var currentHeight = Number(
            getComputedStyle(div).height.match(/[\d.]+/)[0]
          );
          div.style.height = currentHeight + 20 + 'px';
        }
      </script>
    </div>
  </body>
</html>
